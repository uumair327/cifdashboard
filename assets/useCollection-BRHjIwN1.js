import{r as t}from"./vendor-VhFNdCEW.js";import{D as f}from"./RepositoryFactory-CZV-Y2mo.js";import{u as O,l as d}from"./index-Dq3omjz3.js";import"./firebase-BqgI0o68.js";function L(c,n,m={}){const{useRealTime:a=!0,fetchOnMount:E=!0}=m,[A,b]=t.useState(null),[C,o]=t.useState(!0),[p,s]=t.useState(null),{user:h,loading:R}=O(),r=t.useRef(!0),u=t.useRef(null);t.useEffect(()=>(r.current=!0,()=>{r.current=!1,u.current&&(u.current(),u.current=null)}),[]);const l=t.useCallback(async()=>{r.current&&(o(!0),s(null));try{const e=await c.getAll();d.debug(`[useCollection] Fetch successful for ${n}, got ${e.length} items`),r.current&&(b(e),s(null))}catch(e){if(d.error(`[useCollection] Error fetching collection data for ${n}:`,e),r.current){const g=e instanceof f?e:new f({code:"OPERATION_FAILED",message:"Failed to fetch collection data",originalError:e instanceof Error?e:void 0});s(g)}}finally{r.current&&o(!1)}},[c,n]),i=t.useCallback(()=>{r.current&&(o(!0),s(null)),u.current&&u.current(),u.current=c.subscribe(e=>{d.debug(`[useCollection] Real-time update for ${n}, got ${e.length} items`),r.current&&(b(e),s(null),o(!1))},e=>{if(d.error(`[useCollection] Real-time error for ${n}:`,e),r.current){const g=new f({code:"OPERATION_FAILED",message:"Failed to subscribe to collection updates",originalError:e});s(g),o(!1)}})},[c,n]),D=t.useCallback(async()=>{a?i():await l()},[a,i,l]);return t.useEffect(()=>{if(!R&&!(!E||!r.current)){if(!h){r.current&&(o(!1),s(new f({code:"OPERATION_FAILED",message:"User not authenticated"})));return}return a?i():l(),()=>{u.current&&(u.current(),u.current=null)}}},[R,h,E,a,n,i,l]),{data:A,loading:C,error:p,refetch:D}}export{L as u};
