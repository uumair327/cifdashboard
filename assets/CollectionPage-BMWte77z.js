import{r as m,j as e,L as Q,D as ee,F as te,G as se,H as re,I as ae,J as le}from"./vendor-VhFNdCEW.js";import{l as U,a as ne}from"./index-Dq3omjz3.js";import{u as oe}from"./useCollection-BRHjIwN1.js";import{u as ie}from"./useCollectionMutations-C9QFriA7.js";function de(i,s){let t=null;return function(...a){const r=()=>{t=null,i(...a)};t&&clearTimeout(t),t=setTimeout(r,s)}}function J(...i){return i.filter(Boolean).join(" ")}function ce(i,s,t){const l=Math.ceil(i.length/t),a=s*t,r=Math.min(a+t,i.length);return{paginatedData:i.slice(a,r),totalPages:l,startIndex:a,endIndex:r}}function ue(i,s,t){return[...i].sort((l,a)=>{const r=l[s],o=a[s];if(r===o)return 0;let d=0;return r==null?d=1:o==null?d=-1:typeof r=="string"&&typeof o=="string"?d=r.localeCompare(o):typeof r=="number"&&typeof o=="number"?d=r-o:d=String(r).localeCompare(String(o)),t==="asc"?d:-d})}function _({text:i,maxLength:s=100,className:t=""}){const[l,a]=m.useState(!1);if(i.length<=s)return e.jsx("span",{className:t,children:i});const r=l?i:`${i.slice(0,s)}...`;return e.jsxs("div",{className:t,children:[e.jsx("span",{className:"break-words",children:r}),e.jsx("button",{onClick:o=>{o.stopPropagation(),a(!l)},className:"ml-2 text-blue-600 dark:text-blue-400 hover:underline text-xs font-medium",children:l?"Show less":"Show more"})]})}function me({value:i,maxLength:s=150}){if(i==null)return e.jsx("span",{className:"text-slate-400",children:"—"});if(typeof i=="boolean")return e.jsx("span",{className:i?"text-green-600 dark:text-green-400":"text-slate-400",children:i?"✓ Yes":"✗ No"});if(Array.isArray(i)){const r=i.join(", ");return r.length>s?e.jsx(_,{text:r,maxLength:s}):e.jsx("span",{className:"break-words",children:r})}if(typeof i=="object"){const r=JSON.stringify(i,null,2);return e.jsx(_,{text:r,maxLength:s})}const t=String(i);return/^https?:\/\//i.test(t)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline break-all line-clamp-2",onClick:r=>r.stopPropagation(),title:t,children:t}),e.jsx("button",{onClick:r=>{r.stopPropagation(),navigator.clipboard.writeText(t)},className:"flex-shrink-0 p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",title:"Copy URL",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?e.jsx("a",{href:`mailto:${t}`,className:"text-blue-600 dark:text-blue-400 hover:underline break-all",onClick:r=>r.stopPropagation(),children:t}):t.length>s?e.jsx(_,{text:t,maxLength:s}):e.jsx("span",{className:"break-words",children:t})}function xe({data:i,columns:s,loading:t=!1,pagination:l,selection:a,onRowClick:r,className:o,emptyMessage:d="No data available",getRowId:c=x=>x.id||String(Math.random())}){const[x,j]=m.useState(null),[b,p]=m.useState(0),[N,h]=m.useState((l==null?void 0:l.pageSize)||10),[k,w]=m.useState(new Set),g=(l==null?void 0:l.pageSizeOptions)||[10,25,50,100],L=(u,S)=>S.accessorFn?S.accessorFn(u):S.accessorKey?u[S.accessorKey]:null,A=m.useCallback(u=>{!u.sortable||!u.accessorKey||j(F=>(F==null?void 0:F.columnId)===u.id?F.direction==="asc"?{columnId:u.id,direction:"desc"}:null:{columnId:u.id,direction:"asc"})},[]),f=m.useMemo(()=>{if(!x)return i;const u=s.find(S=>S.id===x.columnId);return!u||!u.accessorKey?i:ue(i,u.accessorKey,x.direction)},[i,x,s]),E=m.useMemo(()=>l!=null&&l.enabled?ce(f,b,N):{paginatedData:f,totalPages:1,startIndex:0,endIndex:f.length},[f,b,N,l==null?void 0:l.enabled]),y=E.paginatedData,n=E.totalPages,v=u=>{var S;p(u),(S=l==null?void 0:l.onPageChange)==null||S.call(l,u)},I=u=>{var S;h(u),p(0),(S=l==null?void 0:l.onPageSizeChange)==null||S.call(l,u)},O=u=>{a!=null&&a.enabled&&w(S=>{var z;const F=new Set(S);a.multiple?F.has(u)?F.delete(u):F.add(u):F.has(u)?F.clear():(F.clear(),F.add(u));const V=y.filter(B=>F.has(c(B)));return(z=a.onSelectionChange)==null||z.call(a,V),F})},$=()=>{!(a!=null&&a.enabled)||!a.multiple||w(u=>{var B;const S=y.map(c),F=S.every(q=>u.has(q)),V=new Set(u);F?S.forEach(q=>V.delete(q)):S.forEach(q=>V.add(q));const z=f.filter(q=>V.has(c(q)));return(B=a.onSelectionChange)==null||B.call(a,z),V})},W=u=>k.has(u),D=y.length>0&&y.every(u=>W(c(u))),R=y.some(u=>W(c(u)))&&!D,C=(u,S)=>{const F=L(u,S);return S.cell?S.cell({value:F,row:u}):e.jsx(me,{value:F})},P=u=>{const S=typeof u.header=="function"?u.header():u.header,V=(x==null?void 0:x.columnId)===u.id?x.direction:null;return u.sortable?e.jsxs("button",{onClick:()=>A(u),className:"flex items-center gap-2 hover:text-slate-700 dark:hover:text-slate-200 transition-colors",children:[e.jsx("span",{children:S}),e.jsx("span",{className:"flex flex-col",children:V==="asc"?e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})}):V==="desc"?e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})}):e.jsx("svg",{className:"w-4 h-4 text-slate-300 dark:text-slate-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 12a1 1 0 102 0V6.414l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L5 6.414V12zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z"})})})]}):S};return t?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):i.length===0?e.jsx("div",{className:"text-center p-8 text-slate-500 dark:text-slate-400",children:d}):e.jsxs("div",{className:o,children:[e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-200 dark:border-slate-700",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700 table-fixed",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[(a==null?void 0:a.enabled)&&a.multiple&&e.jsx("th",{scope:"col",className:"px-6 py-3 w-12",children:e.jsx("input",{type:"checkbox",checked:D,ref:u=>{u&&(u.indeterminate=R)},onChange:$,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-slate-300 dark:border-slate-600 rounded cursor-pointer"})}),s.map(u=>e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",style:{width:u.width,minWidth:u.minWidth,maxWidth:u.maxWidth},children:P(u)},u.id))]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-900 divide-y divide-slate-200 dark:divide-slate-700",children:y.map((u,S)=>{const F=c(u),V=W(F);return e.jsxs("tr",{onClick:()=>r==null?void 0:r(u),className:J("transition-colors",V&&"bg-blue-50 dark:bg-blue-900/20",r&&"cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800"),children:[(a==null?void 0:a.enabled)&&e.jsx("td",{className:"px-6 py-4 w-12",children:e.jsx("input",{type:"checkbox",checked:V,onChange:z=>{z.stopPropagation(),O(F)},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-slate-300 dark:border-slate-600 rounded cursor-pointer"})}),s.map(z=>e.jsx("td",{className:"px-6 py-4 text-sm text-slate-900 dark:text-slate-100 max-w-xs break-words",style:{width:z.width,minWidth:z.minWidth,maxWidth:z.maxWidth||"300px"},children:C(u,z)},z.id))]},S)})})]})}),(l==null?void 0:l.enabled)&&n>1&&e.jsxs("div",{className:"bg-white dark:bg-slate-900 px-4 py-3 flex items-center justify-between border-t border-slate-200 dark:border-slate-700 sm:px-6",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>v(b-1),disabled:b===0,className:"relative inline-flex items-center px-4 py-2 border border-slate-300 dark:border-slate-600 text-sm font-medium rounded-md text-slate-700 dark:text-slate-200 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>v(b+1),disabled:b>=n-1,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-slate-300 dark:border-slate-600 text-sm font-medium rounded-md text-slate-700 dark:text-slate-200 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:["Showing ",e.jsx("span",{className:"font-medium",children:E.startIndex+1})," to"," ",e.jsx("span",{className:"font-medium",children:E.endIndex})," of"," ",e.jsx("span",{className:"font-medium",children:f.length})," results"]}),e.jsx("select",{value:N,onChange:u=>I(Number(u.target.value)),className:"ml-2 border border-slate-300 dark:border-slate-600 rounded-md text-sm bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 px-2 py-1",children:g.map(u=>e.jsxs("option",{value:u,children:[u," per page"]},u))})]}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>v(b-1),disabled:b===0,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm font-medium text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),Array.from({length:Math.min(n,7)},(u,S)=>{let F;return n<=7||b<3?F=S:b>n-4?F=n-7+S:F=b-3+S,e.jsx("button",{onClick:()=>v(F),className:J("relative inline-flex items-center px-4 py-2 border text-sm font-medium",F===b?"z-10 bg-blue-50 dark:bg-blue-900 border-blue-500 text-blue-600 dark:text-blue-200":"bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700"),children:F+1},F)}),e.jsxs("button",{onClick:()=>v(b+1),disabled:b>=n-1,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm font-medium text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})]})})]})]})]})}const he=m.memo(xe),G={carousel_items:{collectionType:"carousel_items",defaultFields:["type","imageUrl","link"],expandableFields:["thumbnailUrl","createdAt","updatedAt"],hiddenFields:["id"],searchableFields:["type","link"],sortableFields:["type","createdAt","updatedAt"]},home_images:{collectionType:"home_images",defaultFields:["image","url"],expandableFields:["createdAt","updatedAt"],hiddenFields:["id"],searchableFields:["url"],sortableFields:["url","createdAt","updatedAt"]},forum:{collectionType:"forum",defaultFields:["title","userId","description"],expandableFields:["createdAt","updatedAt"],hiddenFields:["id"],searchableFields:["title","description","userId"],sortableFields:["title","userId","createdAt","updatedAt"]},learn:{collectionType:"learn",defaultFields:["name","thumbnail"],expandableFields:["createdAt","updatedAt"],hiddenFields:["id"],searchableFields:["name"],sortableFields:["name","createdAt","updatedAt"]},quizes:{collectionType:"quizes",defaultFields:["name","thumbnail","use"],expandableFields:["createdAt","updatedAt"],hiddenFields:["id"],searchableFields:["name"],sortableFields:["name","use","createdAt","updatedAt"]},quiz_questions:{collectionType:"quiz_questions",defaultFields:["quiz","question","category","correctOptionIndex"],expandableFields:["options","explanation","createdAt","updatedAt"],hiddenFields:["id"],searchableFields:["quiz","question","category"],sortableFields:["quiz","question","category","createdAt","updatedAt"]},quiz:{collectionType:"quiz",defaultFields:["name","thumbnail","use"],expandableFields:["createdAt","updatedAt"],hiddenFields:["id"],searchableFields:["name"],sortableFields:["name","use","createdAt","updatedAt"]},videos:{collectionType:"videos",defaultFields:["title","category","thumbnailUrl"],expandableFields:["videoUrl","createdAt","updatedAt"],hiddenFields:["id"],searchableFields:["title","category"],sortableFields:["title","category","createdAt","updatedAt"]}};function be(i,s="table"){const t=G[i];return s==="table"?t.defaultFields:[...t.defaultFields,...t.expandableFields]}function fe(i){const s={};for(const[t,l]of Object.entries(i))l!=null&&l!==""&&(s[t]=l);return s}function Y(i){const{collectionType:s,viewMode:t="table"}=i,l=m.useMemo(()=>be(s,t),[s,t]),a=m.useMemo(()=>G[s],[s]),r=m.useMemo(()=>a.searchableFields||[],[a]),o=m.useMemo(()=>a.sortableFields||[],[a]),d=m.useMemo(()=>x=>{const j={};return l.forEach(b=>{b in x&&(j[b]=x[b])}),fe(j)},[l]),c=m.useMemo(()=>x=>l.includes(x),[l]);return{visibleFields:l,filterItem:d,isFieldVisible:c,searchableFields:r,sortableFields:o}}function pe(i){return i==null?"":i instanceof Date?i.toLocaleDateString():typeof i=="boolean"?i?"Yes":"No":Array.isArray(i)?i.join(", "):typeof i=="object"?JSON.stringify(i):String(i)}function ge(i){return i.replace(/([A-Z])/g," $1").replace(/^./,s=>s.toUpperCase()).trim()}function ve({collectionType:i,data:s,loading:t=!1,error:l=null,onSelectionChange:a,onEdit:r,onDelete:o,onRowClick:d,onRetry:c}){const{visibleFields:x}=Y({collectionType:i,viewMode:"table"}),j=m.useMemo(()=>{const N=s||[];return U.debug("[CollectionTable] displayData:",N.length,"items, visibleFields:",x.length),N},[s,x]),b=m.useMemo(()=>{const N=x.map(h=>{const k=h.toLowerCase().includes("url")||h.toLowerCase().includes("link")||h.toLowerCase().includes("image");return{id:h,header:ge(h),accessorKey:h,cell:w=>pe(w),sortable:!0,maxWidth:k?"400px":"300px",minWidth:k?"200px":"100px"}});return(r||o)&&N.push({id:"actions",header:"Actions",cell:h=>e.jsxs("div",{className:"flex gap-2",children:[r&&e.jsx("button",{onClick:k=>{k.stopPropagation(),r(h.row)},className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Edit"}),o&&e.jsx("button",{onClick:k=>{k.stopPropagation(),o(h.row)},className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600",children:"Delete"})]}),sortable:!1}),N},[x,r,o]);if(l)return e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsxs("div",{className:"text-red-500 mb-4",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:l.message})]}),c&&e.jsx("button",{onClick:c,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Retry"})]});if(!t&&(!s||s.length===0))return e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"No Items Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"There are no items in this collection yet."})]});const p=N=>{if(a){const h=N.map(k=>k.id);a(h)}};return e.jsx(he,{data:j,columns:b,loading:t,selection:a?{enabled:!0,multiple:!0,onSelectionChange:p}:void 0,onRowClick:d,pagination:{enabled:!0,pageSize:10,pageSizeOptions:[10,25,50,100]}})}const je=m.memo(ve);function ye({current:i,total:s,label:t}){const l=s>0?Math.round(i/s*100):0;return e.jsxs("div",{className:"w-full",children:[t&&e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[i," / ",s]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${l}%`}})})]})}function ke({selectedItems:i,onBulkDelete:s,onClearSelection:t,loading:l=!1,progress:a}){const[r,o]=m.useState(!1),d=i.length;if(d===0)return null;const c=()=>{s&&(s(i),o(!1))};return e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[a&&a.total>0&&e.jsx("div",{className:"mb-4",children:e.jsx(ye,{current:a.current,total:a.total,label:"Deleting items..."})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[d," item",d!==1?"s":""," selected"]}),t&&e.jsx("button",{onClick:t,className:"text-sm text-blue-600 hover:text-blue-800 underline",disabled:l,children:"Clear selection"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:s&&e.jsx("div",{className:"relative",children:r?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-red-600",children:["Delete ",d," item",d!==1?"s":"","?"]}),e.jsx("button",{onClick:c,disabled:l,className:"inline-flex items-center px-2 py-1 border border-red-300 shadow-sm text-xs font-medium rounded text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Deleting...":"Confirm"}),e.jsx("button",{onClick:()=>o(!1),disabled:l,className:"inline-flex items-center px-2 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]}):e.jsxs("button",{onClick:()=>o(!0),disabled:l,className:"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm leading-4 font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})})})]})]})}function we({onSearch:i,fields:s=[],placeholder:t="Search...",debounceMs:l=300,className:a}){var A;const[r,o]=m.useState(""),[d,c]=m.useState([]),x=m.useCallback(de((f,E)=>{i(f,E)},l),[i,l]);m.useEffect(()=>{x(r,d)},[r,d,x]);const j=f=>{o(f.target.value)},b=()=>{o(""),c([])},[p,N]=m.useState(!1),[h,k]=m.useState({field:((A=s[0])==null?void 0:A.key)||"",operator:"contains",value:""}),w=r.length>0||d.length>0,g=()=>{var f;h.field&&h.value&&(c([...d,h]),k({field:((f=s[0])==null?void 0:f.key)||"",operator:"contains",value:""}),N(!1))},L=f=>{c(d.filter((E,y)=>y!==f))};return e.jsxs("div",{className:J("w-full space-y-2",a),children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:r,onChange:j,placeholder:t,className:"block w-full pl-10 pr-10 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),w&&e.jsx("button",{onClick:b,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"Clear search",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.length>0&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>N(!p),className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})})}),p&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 p-4 z-10",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-900 dark:text-white mb-3",children:"Add Filter"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-600 dark:text-slate-400 mb-1",children:"Field"}),e.jsx("select",{value:h.field,onChange:f=>k({...h,field:f.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm",children:s.map(f=>e.jsx("option",{value:f.key,children:f.label},f.key))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-600 dark:text-slate-400 mb-1",children:"Operator"}),e.jsxs("select",{value:h.operator,onChange:f=>k({...h,operator:f.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm",children:[e.jsx("option",{value:"contains",children:"Contains"}),e.jsx("option",{value:"equals",children:"Equals"}),e.jsx("option",{value:"startsWith",children:"Starts with"}),e.jsx("option",{value:"endsWith",children:"Ends with"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-600 dark:text-slate-400 mb-1",children:"Value"}),e.jsx("input",{type:"text",value:h.value,onChange:f=>k({...h,value:f.target.value}),placeholder:"Enter value...",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:g,disabled:!h.field||!h.value,className:"flex-1 px-3 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"Add Filter"}),e.jsx("button",{onClick:()=>N(!1),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm",children:"Cancel"})]})]})]})]})]}),d.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map((f,E)=>{const y=s.find(n=>n.key===f.field);return e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-sm",children:[e.jsx("span",{className:"font-medium",children:(y==null?void 0:y.label)||f.field}),e.jsx("span",{className:"text-blue-600 dark:text-blue-300",children:f.operator}),e.jsxs("span",{children:['"',f.value,'"']}),e.jsx("button",{onClick:()=>L(E),className:"ml-1 hover:text-blue-900 dark:hover:text-blue-100","aria-label":"Remove filter",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},E)})})]})}class Ne{search(s,t,l){if(!t||t.trim()==="")return s;const a=t.toLowerCase();return s.filter(r=>l.some(o=>{const d=r[o];if(d==null)return!1;const c=String(d);return c.trim()===""?!1:c.toLowerCase().includes(a)}))}filter(s,t){return t.length===0?s:s.filter(l=>t.every(a=>{const r=l[a.field];if(r==null)return!1;const o=String(r).toLowerCase(),d=String(a.value).toLowerCase();switch(a.operator){case"equals":return o===d;case"contains":return o.includes(d);case"startsWith":return o.startsWith(d);case"endsWith":return o.endsWith(d);case"gt":return Number(r)>Number(a.value);case"lt":return Number(r)<Number(a.value);case"gte":return Number(r)>=Number(a.value);case"lte":return Number(r)<=Number(a.value);default:return!1}}))}sort(s,t,l){return[...s].sort((a,r)=>{const o=a[t],d=r[t];if(o===d)return 0;let c=0;return o==null?c=1:d==null?c=-1:typeof o=="string"&&typeof d=="string"?c=o.localeCompare(d):typeof o=="number"&&typeof d=="number"?c=o-d:c=String(o).localeCompare(String(d)),l==="asc"?c:-c})}searchFilterSort(s,t,l,a,r){let o=s;return t&&t.trim()!==""&&(o=this.search(o,t,l)),a.length>0&&(o=this.filter(o,a)),r&&(o=this.sort(o,r.field,r.direction)),o}}function Ce(i,s,t){return JSON.stringify({query:i,filters:s,sortBy:t})}function Se(i,s){const{debounceMs:t=300,searchFields:l}=s,[a,r]=m.useState(""),[o,d]=m.useState(""),[c,x]=m.useState([]),[j,b]=m.useState(null),p=m.useRef(null),N=m.useMemo(()=>new Ne,[]);m.useEffect(()=>{const w=setTimeout(()=>{d(a)},t);return()=>clearTimeout(w)},[a,t]);const h=m.useMemo(()=>{if(!i)return[];const w=Ce(o,c,j);if(p.current&&p.current.key===w)return p.current.result;const g=N.searchFilterSort(i,o,l,c,j||void 0);return p.current={key:w,result:g},g},[i,o,l,c,j,N]),k=m.useCallback(()=>{r(""),d(""),x([]),b(null),p.current=null},[]);return{filteredData:h,query:a,setQuery:r,filters:c,setFilters:x,sortBy:j,setSortBy:b,clearAll:k}}class Fe{static exportToCSV(s,t){if(s.length===0)return"";const l=t||Object.keys(s[0]),a=l.join(","),r=s.map(o=>l.map(d=>{const c=o[d];if(c==null)return"";if(c instanceof Date)return`"${c.toISOString()}"`;if(typeof c=="object")return`"${JSON.stringify(c).replace(/"/g,'""')}"`;const x=String(c);return x.includes(",")||x.includes('"')||x.includes(`
`)?`"${x.replace(/"/g,'""')}"`:x}).join(","));return[a,...r].join(`
`)}static exportToJSON(s,t){if(t){const l=s.map(a=>{const r={};return t.forEach(o=>{o in a&&(r[o]=a[o])}),r});return JSON.stringify(l,null,2)}return JSON.stringify(s,null,2)}static downloadFile(s,t,l){const a=new Blob([s],{type:l}),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}static export(s,t,l,a){let r,o,d;switch(t){case"csv":r=this.exportToCSV(s,a),o="text/csv;charset=utf-8;",d="csv";break;case"json":r=this.exportToJSON(s,a),o="application/json;charset=utf-8;",d="json";break;default:throw new Error(`Unsupported export format: ${t}`)}const c=l.endsWith(`.${d}`)?l:`${l}.${d}`;this.downloadFile(r,c,o)}}function Le({collectionType:i,data:s,loading:t=!1,error:l=null,selectedIds:a=[],onSelectionChange:r,onEdit:o,onDelete:d,onRowClick:c,onRetry:x,showSearch:j=!0,searchPlaceholder:b,onBulkDelete:p,bulkLoading:N=!1,bulkProgress:h,showExport:k=!0}){const[w,g]=m.useState(!1),{searchableFields:L}=Y({collectionType:i});U.debug("[CollectionTableWithSearch] Received data:",s==null?void 0:s.length,"items");const{filteredData:A,query:f,setQuery:E,clearAll:y}=Se(s,{searchFields:L,debounceMs:300});U.debug("[CollectionTableWithSearch] filteredData:",A.length,"items");const n=m.useMemo(()=>b||`Search ${i.replace(/_/g," ")}...`,[b,i]),v=C=>{E(C)},I=(s==null?void 0:s.length)||0,O=A.length,$=f.trim().length>0,W=m.useMemo(()=>!a.length||!A.length?[]:A.filter(C=>a.includes(C.id)),[a,A]),D=()=>{r&&r([])},R=C=>{const P=new Date().toISOString().split("T")[0],u=`${i}_${P}`;Fe.export(A,C,u),g(!1)};return e.jsxs("div",{className:"space-y-4",children:[j&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-md w-full",children:e.jsx(we,{onSearch:v,placeholder:n,debounceMs:300})}),!t&&s&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:$?e.jsxs("span",{children:["Showing ",O," of ",I," items",f&&e.jsxs("span",{className:"ml-1",children:['for "',e.jsx("span",{className:"font-medium",children:f}),'"']})]}):e.jsxs("span",{children:[I," items"]})}),k&&A.length>0&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>g(!w),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Export",e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>R("csv"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Export as CSV"}),e.jsx("button",{onClick:()=>R("json"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Export as JSON"})]})})]})]})]}),r&&p&&e.jsx(ke,{selectedItems:W,onBulkDelete:p,onClearSelection:D,loading:N,progress:h}),!t&&$&&O===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-lg font-medium",children:"No results found"}),e.jsxs("p",{className:"mt-1",children:["Try adjusting your search query or"," ",e.jsx("button",{onClick:y,className:"text-blue-600 hover:text-blue-800 underline",children:"clear the search"})]})]}),e.jsx(je,{collectionType:i,data:A,loading:t,error:l,selectedIds:a,onSelectionChange:r,onEdit:o,onDelete:d,onRowClick:c,onRetry:x})]})}function Ee({value:i,onChange:s,onBlur:t,options:l,placeholder:a="Select or type...",disabled:r=!1,required:o=!1,allowCustom:d=!0,className:c=""}){const[x,j]=m.useState(!1),[b,p]=m.useState(""),[N,h]=m.useState(i),k=m.useRef(null),w=m.useRef(null);m.useEffect(()=>{h(i)},[i]);const g=l.filter(y=>y.toLowerCase().includes(b.toLowerCase()));m.useEffect(()=>{const y=n=>{k.current&&!k.current.contains(n.target)&&(j(!1),p(""),t==null||t())};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[t]);const L=y=>{h(y),s(y),j(!1),p("")},A=y=>{h(y),p(y),j(!0),d&&s(y)},f=()=>{var y;h(""),s(""),p(""),(y=w.current)==null||y.focus()},E=y=>{y.key==="Enter"&&g.length>0?(y.preventDefault(),L(g[0])):y.key==="Escape"&&(j(!1),p(""))};return e.jsxs("div",{ref:k,className:`relative ${c}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:w,type:"text",value:N,onChange:y=>A(y.target.value),onFocus:()=>j(!0),onKeyDown:E,placeholder:a,disabled:r,required:o,className:"block w-full px-3 py-2 pr-20 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-50 disabled:cursor-not-allowed"}),e.jsxs("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 gap-1",children:[N&&!r&&e.jsx("button",{type:"button",onClick:f,className:"p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",tabIndex:-1,children:e.jsx(Q,{size:16,className:"text-slate-400"})}),e.jsx("button",{type:"button",onClick:()=>!r&&j(!x),className:"p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",tabIndex:-1,children:e.jsx(ee,{size:16,className:`text-slate-400 transition-transform ${x?"rotate-180":""}`})})]})]}),x&&!r&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md shadow-lg max-h-60 overflow-auto",children:g.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-slate-500 dark:text-slate-400",children:d?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{size:14}),e.jsxs("span",{children:['Type to add "',N,'"']})]}):"No options found"}):e.jsx("ul",{className:"py-1",children:g.map((y,n)=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>L(y),className:"w-full text-left px-3 py-2 text-sm hover:bg-blue-50 dark:hover:bg-blue-900/20 text-slate-900 dark:text-white transition-colors",children:y})},n))})})]})}function Ae({collectionType:i,fields:s,initialData:t={},onSubmit:l,onCancel:a,loading:r=!1,submitLabel:o="Save",cancelLabel:d="Cancel"}){const[c,x]=m.useState(t),[j,b]=m.useState({}),[p,N]=m.useState({}),[h,k]=m.useState(!1);m.useEffect(()=>{x(t),b({}),N({})},[JSON.stringify(t)]);const w=(n,v)=>{var I,O,$,W,D,R;if(n.required){if(v==null||v==="")return`${n.label} is required`;if(typeof v=="string"&&v.trim()==="")return`${n.label} is required`}if(!v||typeof v=="string"&&v.trim()==="")return null;if(n.type==="email"&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v))return"Please enter a valid email address";if(n.type==="url")try{new URL(v)}catch{return"Please enter a valid URL"}if(n.type==="number"){const C=Number(v);if(isNaN(C))return"Please enter a valid number";if(((I=n.validation)==null?void 0:I.min)!==void 0&&C<n.validation.min)return`Value must be at least ${n.validation.min}`;if(((O=n.validation)==null?void 0:O.max)!==void 0&&C>n.validation.max)return`Value must be at most ${n.validation.max}`}if(typeof v=="string"){if((($=n.validation)==null?void 0:$.minLength)!==void 0&&v.length<n.validation.minLength)return`Must be at least ${n.validation.minLength} characters`;if(((W=n.validation)==null?void 0:W.maxLength)!==void 0&&v.length>n.validation.maxLength)return`Must be at most ${n.validation.maxLength} characters`}if((D=n.validation)!=null&&D.pattern&&typeof v=="string"&&!n.validation.pattern.test(v))return n.validation.message||"Invalid format";if((R=n.validation)!=null&&R.custom){const C=n.validation.custom(v);if(C)return C}return null},g=()=>{const n={};return s.forEach(v=>{const I=w(v,c[v.name]);I&&(n[v.name]=I)}),b(n),Object.keys(n).length===0},L=(n,v)=>{x(I=>({...I,[n]:v})),j[n]&&b(I=>{const{[n]:O,...$}=I;return $})},A=n=>{N(I=>({...I,[n.name]:!0}));const v=w(n,c[n.name]);v&&b(I=>({...I,[n.name]:v}))},f=async n=>{n.preventDefault();const v={};if(s.forEach(I=>{v[I.name]=!0}),N(v),!!g()){k(!0);try{await l(c)}finally{k(!1)}}},E=r||h,y=n=>{var $,W,D;const v=c[n.name]??"",O=`
      block w-full px-3 py-2 border rounded-md shadow-sm 
      focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500
      ${(p[n.name]?j[n.name]:void 0)?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-slate-600"}
      ${E?"bg-gray-50 dark:bg-slate-800 cursor-not-allowed":"bg-white dark:bg-slate-900"}
      text-slate-900 dark:text-white
      placeholder:text-slate-400 dark:placeholder:text-slate-500
    `.trim();switch(n.type){case"textarea":return e.jsx("textarea",{id:n.name,name:n.name,value:v,onChange:C=>L(n.name,C.target.value),onBlur:()=>A(n),placeholder:n.placeholder,required:n.required,disabled:E,rows:4,className:O});case"select":return e.jsxs("select",{id:n.name,name:n.name,value:v,onChange:C=>L(n.name,C.target.value),onBlur:()=>A(n),required:n.required,disabled:E,className:O,children:[e.jsxs("option",{value:"",children:["Select ",n.label]}),($=n.options)==null?void 0:$.map(C=>{const P=typeof C=="string"?C:C.value,u=typeof C=="string"?C:C.label;return e.jsx("option",{value:P,children:u},P)})]});case"searchable-select":const R=Array.isArray(n.options)?n.options.map(C=>typeof C=="string"?C:C.value):[];return e.jsx(Ee,{value:v,onChange:C=>L(n.name,C),onBlur:()=>A(n),options:R,placeholder:n.placeholder,disabled:E,required:n.required,allowCustom:n.allowCustom!==!1});case"checkbox":return e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:n.name,name:n.name,type:"checkbox",checked:!!v,onChange:C=>L(n.name,C.target.checked),onBlur:()=>A(n),disabled:E,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:n.name,className:"ml-2 block text-sm text-gray-900",children:n.label})]});default:return e.jsx("input",{id:n.name,name:n.name,type:n.type,value:v,onChange:C=>L(n.name,C.target.value),onBlur:()=>A(n),placeholder:n.placeholder,required:n.required,disabled:E,min:(W=n.validation)==null?void 0:W.min,max:(D=n.validation)==null?void 0:D.max,className:O})}};return e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[s.map(n=>e.jsxs("div",{children:[n.type!=="checkbox"&&e.jsxs("label",{htmlFor:n.name,className:"block text-sm font-medium text-gray-700 mb-1",children:[n.label,n.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),y(n),p[n.name]&&j[n.name]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j[n.name]})]},n.name)),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[a&&e.jsx("button",{type:"button",onClick:a,disabled:E,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:d}),e.jsx("button",{type:"submit",disabled:E,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Saving...":o})]})]})}class Me{static parseCSV(s){const t=s.trim().split(`
`);if(t.length===0)throw new Error("CSV file is empty");const l=t[0].split(",").map(r=>r.trim().replace(/^"|"$/g,"")),a=[];for(let r=1;r<t.length;r++){const o=t[r].trim();if(!o)continue;const d=this.parseCSVLine(o),c={};l.forEach((x,j)=>{d[j]!==void 0&&(c[x]=d[j])}),a.push(c)}return a}static parseCSVLine(s){const t=[];let l="",a=!1;for(let r=0;r<s.length;r++){const o=s[r];o==='"'?a=!a:o===","&&!a?(t.push(l.trim()),l=""):l+=o}return t.push(l.trim()),t}static parseJSON(s){try{const t=JSON.parse(s);if(Array.isArray(t))return t;if(typeof t=="object"&&t!==null)return[t];throw new Error("JSON must be an array or object")}catch(t){throw new Error(`Invalid JSON: ${t.message}`)}}static validate(s,t,l=[]){const a=[],r=[],o=[];return s.forEach((d,c)=>{const x=c+1;let j=!1;t.forEach(p=>{(!d[p]||d[p]==="")&&(r.push({row:x,field:p,message:`Required field "${p}" is missing or empty`}),j=!0)});const b=[...t,...l];Object.keys(d).forEach(p=>{!b.includes(p)&&p!=="id"&&o.push({row:x,field:p,message:`Unknown field "${p}" will be ignored`})}),j||a.push(d)}),{data:a,errors:r,warnings:o}}static readFile(s){return new Promise((t,l)=>{const a=new FileReader;a.onload=r=>{var d;const o=(d=r.target)==null?void 0:d.result;t(o)},a.onerror=()=>{l(new Error("Failed to read file"))},a.readAsText(s)})}static async processImport(s,t,l=[]){const a=await this.readFile(s),r=s.name.toLowerCase().endsWith(".json")?"json":"csv";let o;try{r==="json"?o=this.parseJSON(a):o=this.parseCSV(a)}catch(d){return{data:[],errors:[{row:0,message:d.message}],warnings:[]}}return this.validate(o,t,l)}}function Ie({isOpen:i,onClose:s,onImport:t,requiredFields:l,optionalFields:a=[],collectionName:r}){const[o,d]=m.useState(null),[c,x]=m.useState(null),[j,b]=m.useState(!1),[p,N]=m.useState("upload");if(!i)return null;const h=async g=>{var f;const L=(f=g.target.files)==null?void 0:f[0];if(!L)return;const A=L.name.toLowerCase();if(!A.endsWith(".csv")&&!A.endsWith(".json")){alert("Please select a CSV or JSON file");return}d(L),b(!0);try{const E=await Me.processImport(L,l,a);x(E),N("preview")}catch(E){alert(`Error processing file: ${E.message}`)}finally{b(!1)}},k=async()=>{if(!(!c||c.data.length===0)){b(!0);try{await t(c.data),w()}catch(g){alert(`Error importing data: ${g.message}`)}finally{b(!1)}}},w=()=>{d(null),x(null),N("upload"),s()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["Import ",r]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Upload CSV or JSON file to import multiple items"})]}),e.jsx("button",{onClick:w,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(Q,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[p==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-8 text-center",children:[e.jsx(se,{className:"w-12 h-12 mx-auto text-slate-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Choose a file to import"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Supports CSV and JSON formats"}),e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".csv,.json",onChange:h,className:"hidden",disabled:j}),e.jsx("span",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer inline-block",children:j?"Processing...":"Select File"})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Required Fields"}),e.jsx("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:l.map(g=>e.jsxs("li",{children:["• ",g]},g))}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mt-3 mb-2",children:"Optional Fields"}),e.jsx("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:a.map(g=>e.jsxs("li",{children:["• ",g]},g))})]})]})]}),p==="preview"&&c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-300 mb-1",children:[e.jsx(re,{size:20}),e.jsx("span",{className:"font-semibold",children:"Valid Rows"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-900 dark:text-green-100",children:c.data.length})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300 mb-1",children:[e.jsx(ae,{size:20}),e.jsx("span",{className:"font-semibold",children:"Errors"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-900 dark:text-red-100",children:c.errors.length})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-700 dark:text-yellow-300 mb-1",children:[e.jsx(le,{size:20}),e.jsx("span",{className:"font-semibold",children:"Warnings"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900 dark:text-yellow-100",children:c.warnings.length})]})]}),c.errors.length>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 max-h-48 overflow-y-auto",children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-100 mb-2",children:"Errors Found"}),e.jsx("ul",{className:"text-sm text-red-800 dark:text-red-200 space-y-1",children:c.errors.map((g,L)=>e.jsxs("li",{children:["Row ",g.row,": ",g.message]},L))})]}),c.warnings.length>0&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 max-h-48 overflow-y-auto",children:[e.jsx("h4",{className:"font-semibold text-yellow-900 dark:text-yellow-100 mb-2",children:"Warnings"}),e.jsx("ul",{className:"text-sm text-yellow-800 dark:text-yellow-200 space-y-1",children:c.warnings.map((g,L)=>e.jsxs("li",{children:["Row ",g.row,": ",g.message]},L))})]}),c.data.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white mb-2",children:"Preview (First 5 rows)"}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900",children:e.jsx("tr",{children:Object.keys(c.data[0]).map(g=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:g},g))})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:c.data.slice(0,5).map((g,L)=>e.jsx("tr",{children:Object.values(g).map((A,f)=>e.jsx("td",{className:"px-4 py-2 text-sm text-slate-900 dark:text-white whitespace-nowrap",children:String(A)},f))},L))})]})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:w,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Cancel"}),p==="preview"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{N("upload"),d(null),x(null)},className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Choose Different File"}),e.jsx("button",{onClick:k,disabled:j||!c||c.data.length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:j?"Importing...":`Import ${(c==null?void 0:c.data.length)||0} Items`})]})]})]})})}const De={sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl",full:"max-w-full mx-4"};function H({isOpen:i,onClose:s,title:t,children:l,size:a="md",showCloseButton:r=!0,closeOnBackdropClick:o=!0,closeOnEscape:d=!0,footer:c,className:x}){const j=m.useRef(null),b=m.useRef(null);m.useEffect(()=>{if(!i||!d)return;const h=k=>{k.key==="Escape"&&s()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[i,d,s]),m.useEffect(()=>{var k;if(!i)return;b.current=document.activeElement;const h=(k=j.current)==null?void 0:k.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');return h&&h.length>0&&h[0].focus(),()=>{var w;(w=b.current)==null||w.focus()}},[i]),m.useEffect(()=>(i?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[i]);const p=h=>{var L;if(h.key!=="Tab")return;const k=(L=j.current)==null?void 0:L.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!k||k.length===0)return;const w=k[0],g=k[k.length-1];h.shiftKey?document.activeElement===w&&(h.preventDefault(),g.focus()):document.activeElement===g&&(h.preventDefault(),w.focus())},N=h=>{o&&h.target===h.currentTarget&&s()};return i?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm transition-opacity",onClick:N}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{ref:j,onKeyDown:p,className:J("relative w-full bg-white dark:bg-slate-800 rounded-lg shadow-xl transform transition-all",De[a],x),children:[(t||r)&&e.jsxs("div",{className:"flex items-center justify-between p-4 md:p-6 border-b border-slate-200 dark:border-slate-700",children:[t&&e.jsx("h3",{id:"modal-title",className:"text-lg md:text-xl font-semibold text-slate-900 dark:text-white",children:t}),r&&e.jsx("button",{onClick:s,className:"ml-auto text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg p-1","aria-label":"Close modal",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 md:p-6",children:l}),c&&e.jsx("div",{className:"flex items-center justify-end gap-3 p-4 md:p-6 border-t border-slate-200 dark:border-slate-700",children:c})]})})]}):null}function ze({collectionType:i,title:s,formFields:t,repository:l}){const[a,r]=m.useState(!1),[o,d]=m.useState(!1),[c,x]=m.useState(null),[j,b]=m.useState([]),[p,N]=m.useState(null),[h,k]=m.useState(),{addToast:w}=ne(),{data:g,loading:L,error:A,refetch:f}=oe(l,i);U.debug("[CollectionPage] data from useCollection:",g==null?void 0:g.length,"items");const{create:E,update:y,deleteItem:n,bulkDelete:v,creating:I,updating:O,deleting:$,bulkDeleting:W}=ie(l,{collectionName:i,onSuccess:()=>f(),onProgress:(M,T)=>{k({current:M,total:T})}}),D=I||O||$||W,R=()=>{x(null),r(!0)},C=M=>{x(M),r(!0)},P=M=>{N(M)},u=async()=>{if(p)try{await n(p.id),w("success","Item deleted successfully"),N(null)}catch(M){w("error",`Failed to delete item: ${M instanceof Error?M.message:"Unknown error"}`)}},S=async M=>{try{await v(M.map(T=>T.id)),w("success",`${M.length} items deleted successfully`),b([])}catch(T){w("error",`Failed to delete items: ${T instanceof Error?T.message:"Unknown error"}`)}},F=async M=>{try{c?(await y(c.id,M),w("success","Item updated successfully")):(await E(M),w("success","Item created successfully")),r(!1),x(null)}catch(T){w("error",`Failed to save item: ${T instanceof Error?T.message:"Unknown error"}`)}},V=()=>{r(!1),x(null)},z=async M=>{try{let T=0,K=0;for(const X of M)try{await E(X),T++}catch(Z){K++,U.error("Failed to import item:",Z)}T>0&&w("success",`Successfully imported ${T} items`),K>0&&w("error",`Failed to import ${K} items`),d(!1),f()}catch(T){w("error",`Import failed: ${T instanceof Error?T.message:"Unknown error"}`)}},B=t.filter(M=>M.required).map(M=>M.name),q=t.filter(M=>!M.required).map(M=>M.name);return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:s}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:f,disabled:L,className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Refresh data",children:[e.jsx("svg",{className:`w-5 h-5 mr-2 ${L?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),e.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Import"]}),e.jsxs("button",{onClick:R,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add New"]})]})]}),e.jsx(Le,{collectionType:i,data:g,loading:L,error:A,selectedIds:j,onSelectionChange:b,onEdit:C,onDelete:P,onBulkDelete:S,onRetry:f,bulkLoading:D,bulkProgress:h}),e.jsx(H,{isOpen:a,onClose:V,title:c?"Edit Item":"Add New Item",children:e.jsx(Ae,{collectionType:i,fields:t,initialData:c||void 0,onSubmit:F,onCancel:V,loading:D,submitLabel:c?"Update":"Create"})}),e.jsx(Ie,{isOpen:o,onClose:()=>d(!1),onImport:z,requiredFields:B,optionalFields:q,collectionName:s}),e.jsx(H,{isOpen:!!p,onClose:()=>N(null),title:"Confirm Delete",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this item? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>N(null),disabled:D,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:D,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:D?"Deleting...":"Delete"})]})]})})]})}export{ze as C};
