import{j as e,K as W,M as Y,N as T,P as Z,Q as ee,S as te,r,T as $,U as M}from"./vendor-VhFNdCEW.js";import{c as N}from"./RepositoryFactory-CZV-Y2mo.js";import{u as w}from"./useCollection-BRHjIwN1.js";import{u as Q}from"./useCollectionMutations-C9QFriA7.js";import{a as se}from"./index-Dq3omjz3.js";import"./firebase-BqgI0o68.js";function ae({quiz:s,isSelected:g,questionCount:n,onSelect:c,onDelete:i,onToggleUse:l}){return e.jsxs("div",{onClick:c,className:`
        group relative bg-white dark:bg-slate-700 rounded-lg p-4 cursor-pointer 
        transition-all duration-200 hover:shadow-lg
        ${g?"ring-2 ring-blue-500 shadow-lg":"hover:ring-2 hover:ring-slate-300 dark:hover:ring-slate-600"}
      `,children:[s.thumbnail&&e.jsx("div",{className:"relative w-full h-32 mb-3 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-600",children:e.jsx("img",{src:s.thumbnail,alt:s.name,className:"w-full h-full object-cover",onError:d=>{d.currentTarget.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100"%3E%3Crect fill="%23ddd" width="100" height="100"/%3E%3Ctext fill="%23999" x="50%25" y="50%25" text-anchor="middle" dy=".3em"%3ENo Image%3C/text%3E%3C/svg%3E'}})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white truncate",children:s.name}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-600 dark:text-slate-400",children:[n," ",n===1?"question":"questions"]}),e.jsx("div",{className:`
            px-2 py-1 rounded-full text-xs font-medium
            ${s.use?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-slate-100 dark:bg-slate-600 text-slate-600 dark:text-slate-400"}
          `,children:s.use?"Active":"Inactive"})]})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[l&&e.jsx("button",{onClick:d=>{d.stopPropagation(),l()},className:`
              p-2 rounded-lg transition-colors
              ${s.use?"bg-green-500 hover:bg-green-600 text-white":"bg-slate-400 hover:bg-slate-500 text-white"}
            `,title:s.use?"Deactivate quiz":"Activate quiz",children:s.use?e.jsx(W,{size:16}):e.jsx(Y,{size:16})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),i()},className:"p-2 rounded-lg bg-red-500 hover:bg-red-600 text-white transition-colors",title:"Delete quiz",children:e.jsx(T,{size:16})})]})]})}function re({question:s,index:g,onEdit:n,onDelete:c}){return e.jsxs("div",{className:"bg-white dark:bg-slate-700 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-sm font-medium",children:g+1}),e.jsx("span",{className:"px-2 py-1 rounded-md bg-slate-100 dark:bg-slate-600 text-slate-700 dark:text-slate-300 text-xs font-medium",children:s.category})]}),e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:s.question})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:n,className:"p-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white transition-colors",title:"Edit question",children:e.jsx(Z,{size:16})}),e.jsx("button",{onClick:c,className:"p-2 rounded-lg bg-red-500 hover:bg-red-600 text-white transition-colors",title:"Delete question",children:e.jsx(T,{size:16})})]})]}),s.explanation&&e.jsx("div",{className:"mb-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-200 italic",children:["ðŸ’¡ ",s.explanation]})}),e.jsx("div",{className:"space-y-2",children:s.options.map((i,l)=>e.jsxs("div",{className:`
              p-3 rounded-lg flex items-center gap-3 transition-colors
              ${l===s.correctOptionIndex?"bg-green-50 dark:bg-green-900/20 border-2 border-green-500 dark:border-green-600":"bg-slate-50 dark:bg-slate-600 border-2 border-transparent"}
            `,children:[l===s.correctOptionIndex&&e.jsx("span",{className:"flex-shrink-0 text-green-600 dark:text-green-400 font-bold text-lg",children:"âœ“"}),e.jsx("span",{className:`
              flex-1 text-sm
              ${l===s.correctOptionIndex?"text-green-900 dark:text-green-100 font-medium":"text-gray-700 dark:text-gray-300"}
            `,children:i})]},l))})]})}function le({question:s,isEditing:g,onSave:n,onCancel:c,onChange:i}){var d,h;const l=s.question&&s.category&&((d=s.options)==null?void 0:d.every(a=>a.trim()));return e.jsx("div",{className:"bg-white dark:bg-slate-700 rounded-lg p-6 shadow-lg",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:g?"Edit Question":"Add New Question"}),e.jsx("button",{onClick:c,className:"p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors",title:"Close",children:e.jsx(ee,{size:24,className:"text-gray-600 dark:text-gray-400"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:["Question ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:s.question||"",onChange:a=>i("question",a.target.value),className:"w-full p-3 rounded-lg bg-slate-50 dark:bg-slate-600 text-gray-900 dark:text-white border-2 border-slate-200 dark:border-slate-500 focus:border-blue-500 focus:outline-none transition-colors",rows:3,placeholder:"Enter your question here..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.category||"",onChange:a=>i("category",a.target.value),className:"w-full p-3 rounded-lg bg-slate-50 dark:bg-slate-600 text-gray-900 dark:text-white border-2 border-slate-200 dark:border-slate-500 focus:border-blue-500 focus:outline-none transition-colors",placeholder:"e.g., Cyberbullying, Online Safety"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-3 text-gray-700 dark:text-gray-300",children:["Answer Options ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx("span",{className:"ml-2 text-xs text-slate-500 dark:text-slate-400",children:"(Click the radio button to mark the correct answer)"})]}),e.jsx("div",{className:"space-y-3",children:(h=s.options)==null?void 0:h.map((a,x)=>e.jsxs("div",{className:`
                  flex gap-3 items-center p-4 rounded-lg transition-all
                  ${s.correctOptionIndex===x?"bg-green-50 dark:bg-green-900/20 border-2 border-green-500 shadow-sm":"bg-slate-50 dark:bg-slate-600 border-2 border-slate-200 dark:border-slate-500 hover:border-slate-300 dark:hover:border-slate-400"}
                `,children:[e.jsx("input",{type:"radio",name:"correctOption",checked:s.correctOptionIndex===x,onChange:()=>i("correctOptionIndex",x),className:"w-5 h-5 cursor-pointer text-green-600 focus:ring-2 focus:ring-green-500"}),e.jsx("input",{type:"text",value:a,onChange:v=>{const f=[...s.options||[]];f[x]=v.target.value,i("options",f)},className:"flex-1 p-2 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white border border-slate-300 dark:border-slate-500 focus:border-blue-500 focus:outline-none transition-colors",placeholder:`Option ${x+1}`}),s.correctOptionIndex===x&&e.jsx("span",{className:"flex-shrink-0 px-3 py-1 rounded-full bg-green-500 text-white text-xs font-medium",children:"âœ“ Correct"})]},x))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:["Explanation (Optional)",e.jsx("span",{className:"ml-2 text-xs text-slate-500 dark:text-slate-400",children:"Help users understand why this is the correct answer"})]}),e.jsx("textarea",{value:s.explanation||"",onChange:a=>i("explanation",a.target.value),className:"w-full p-3 rounded-lg bg-slate-50 dark:bg-slate-600 text-gray-900 dark:text-white border-2 border-slate-200 dark:border-slate-500 focus:border-blue-500 focus:outline-none transition-colors",rows:3,placeholder:"Provide an explanation for the correct answer..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200 dark:border-slate-600",children:[e.jsxs("button",{onClick:n,disabled:!l,className:`
              flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all
              ${l?"bg-green-500 hover:bg-green-600 text-white shadow-lg hover:shadow-xl":"bg-slate-300 dark:bg-slate-600 text-slate-500 dark:text-slate-400 cursor-not-allowed"}
            `,children:[e.jsx(te,{size:20}),g?"Save Changes":"Add Question"]}),e.jsx("button",{onClick:c,className:"px-6 py-3 rounded-lg font-medium bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors",children:"Cancel"})]})]})})}function ue(){const[s,g]=r.useState(null),[n,c]=r.useState(null),[i,l]=r.useState(!1),[d,h]=r.useState({question:"",options:["","","",""],correctOptionIndex:0,category:"",explanation:""}),{addToast:a}=se(),x=r.useMemo(()=>N("quiz"),[]),v=r.useMemo(()=>N("quizes"),[]),f=r.useMemo(()=>N("quiz_questions"),[]),{data:z,loading:q,refetch:P}=w(x,"quiz"),{data:C,loading:R,refetch:L}=w(v,"quizes"),{data:u,loading:_,refetch:U}=w(f,"quiz_questions"),{deleteItem:O,update:F}=Q(x,{collectionName:"quiz",onSuccess:()=>P()}),{deleteItem:E,update:I}=Q(v,{collectionName:"quizes",onSuccess:()=>L()}),{create:S,update:A,deleteItem:y}=Q(f,{collectionName:"quiz_questions",onSuccess:()=>{U(),c(null),l(!1),j()}}),b=r.useMemo(()=>[...z||[],...C||[]],[z,C]),H=q||R||_,m=r.useMemo(()=>b.find(t=>t.id===s),[b,s]),p=r.useMemo(()=>!m||!u?[]:u.filter(t=>t.quiz===m.name),[m,u]),j=r.useCallback(()=>{h({question:"",options:["","","",""],correctOptionIndex:0,category:"",explanation:""})},[]),K=r.useCallback(t=>{c(t),l(!1),h({question:t.question,options:[...t.options],correctOptionIndex:t.correctOptionIndex,category:t.category,explanation:t.explanation||""})},[]),D=r.useCallback(()=>{l(!0),c(null),j()},[j]),V=r.useCallback(async()=>{if(!m)return;const t={...d,quiz:m.name};try{n?(await A(n.id,t),a("success","Question updated successfully")):(await S(t),a("success","Question created successfully"))}catch{a("error","Failed to save question")}},[m,d,n,A,S,a]),X=r.useCallback(async t=>{if(window.confirm(`Delete "${t.name}"? This will also delete all ${p.length} questions.`))try{const o=(u==null?void 0:u.filter(k=>k.quiz===t.name))||[];for(const k of o)await y(k.id);try{await O(t.id)}catch{await E(t.id)}a("success","Quiz deleted successfully"),s===t.id&&g(null)}catch{a("error","Failed to delete quiz")}},[u,y,O,E,a,s,p.length]),B=r.useCallback(async t=>{try{const o={use:!t.use};try{await F(t.id,o)}catch{await I(t.id,o)}a("success",`Quiz ${t.use?"deactivated":"activated"}`)}catch{a("error","Failed to update quiz")}},[F,I,a]),G=r.useCallback(async t=>{if(window.confirm("Delete this question?"))try{await y(t.id),a("success","Question deleted successfully")}catch{a("error","Failed to delete question")}},[y,a]),J=r.useCallback(()=>{c(null),l(!1),j()},[j]);return H?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Loading quizzes..."})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Quizzes"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Select a quiz to manage its questions"})]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[b.length," ",b.length===1?"quiz":"quizzes"]})]}),b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"mx-auto h-12 w-12 text-slate-400 mb-4"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No quizzes found"})]}):e.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:b.map(t=>e.jsx(ae,{quiz:t,isSelected:s===t.id,questionCount:(u==null?void 0:u.filter(o=>o.quiz===t.name).length)||0,onSelect:()=>g(t.id),onDelete:()=>X(t),onToggleUse:()=>B(t)},t.id))})]}),m&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:['Questions for "',m.name,'"']}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:[p.length," ",p.length===1?"question":"questions"]})]}),!n&&!i&&e.jsxs("button",{onClick:D,className:"flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors shadow-lg hover:shadow-xl",children:[e.jsx(M,{}),"Add Question"]})]}),(n||i)&&e.jsx("div",{className:"mb-6",children:e.jsx(le,{question:d,isEditing:!!n,onSave:V,onCancel:J,onChange:(t,o)=>h(k=>({...k,[t]:o}))})}),!n&&!i&&e.jsx(e.Fragment,{children:p.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-slate-700 rounded-lg",children:[e.jsx($,{className:"mx-auto h-12 w-12 text-slate-400 mb-4"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"No questions yet"}),e.jsxs("button",{onClick:D,className:"inline-flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(M,{}),"Add First Question"]})]}):e.jsx("div",{className:"space-y-4",children:p.map((t,o)=>e.jsx(re,{question:t,index:o,onEdit:()=>K(t),onDelete:()=>G(t)},t.id))})})]})]})}export{ue as default};
