import{r as m,j as e,z as C,A as S,y as N,B as E,q as I,C as A,D as L,L as z,E as R}from"./vendor-VhFNdCEW.js";import{e as p,q as w,f as k,w as U,h as y,j as g,k as v,l as q,m as P,n as j}from"./firebase-BqgI0o68.js";import{d as x,l as h,u as F}from"./index-Dq3omjz3.js";class T{getForums(s,n,r){const a=p(x,"forum"),t=w(a,U("category","==",s),k("createdAt","desc"));return y(t,o=>{const u=o.docs.map(c=>{const i=c.data();return{id:i.id,userId:i.userId,title:i.title,description:i.description,createdAt:new Date(i.createdAt),category:i.category}});n(u)},o=>{h.error("Error fetching forums:",o),r(o)})}getComments(s,n,r){const a=p(x,"forum",s,"comments"),t=w(a,k("createdAt","desc"));return y(t,o=>{const u=o.docs.map(c=>{const i=c.data();return{id:i.id,userId:i.userId,forumId:i.forumId,text:i.text,createdAt:new Date(i.createdAt)}});n(u)},o=>{h.error("Error fetching comments:",o),r(o)})}async addComment(s,n,r){const a=Date.now().toString(),t=g(x,"forum",s,"comments",a),d={id:a,userId:r,forumId:s,text:n,createdAt:new Date};await v(t,{...d,createdAt:d.createdAt.toISOString()})}async getUserDetails(s){try{const n=g(x,"users",s),r=await q(n);if(!r.exists())return{userName:"Anonymous",userImage:"",userEmail:"anonymous@mail.com",role:"child"};const a=r.data();return{userName:a.userName||"Anonymous",userImage:a.userImage||"",userEmail:a.userEmail||"anonymous@mail.com",role:a.role||"child"}}catch(n){return h.error("Error fetching user details:",n),{userName:"Anonymous",userImage:"",userEmail:"anonymous@mail.com",role:"child"}}}async createForum(s,n,r,a){const t=Date.now().toString(),d=g(x,"forum",t),o={id:t,userId:a,title:s,description:n,createdAt:new Date,category:r};return await v(d,{...o,createdAt:o.createdAt.toISOString()}),t}async deleteForum(s){const n=p(x,"forum",s,"comments"),a=(await P(n)).docs.map(d=>j(d.ref));await Promise.all(a);const t=g(x,"forum",s);await j(t)}async deleteComment(s,n){const r=g(x,"forum",s,"comments",n);await j(r)}}function M(l,s){const[n,r]=m.useState([]),[a,t]=m.useState(!0),[d,o]=m.useState(null);return m.useEffect(()=>{t(!0),o(null);const u=l.getForums(s,c=>{r(c),t(!1)},c=>{o(c),t(!1)});return()=>u()},[l,s]),{forums:n,loading:a,error:d}}function B(l,s){const[n,r]=m.useState([]),[a,t]=m.useState(!1),[d,o]=m.useState(null);return m.useEffect(()=>{if(!s){r([]),t(!1);return}t(!0),o(null);const u=l.getComments(s,c=>{r(c),t(!1)},c=>{o(c),t(!1)});return()=>u()},[l,s]),{comments:n,loading:a,error:d}}function O({comment:l,repository:s,onDelete:n}){const[r,a]=m.useState(null);m.useEffect(()=>{s.getUserDetails(l.userId).then(a)},[l.userId,s]);const t=o=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(o),d=async()=>{confirm("Are you sure you want to delete this comment?")&&await n()};return e.jsxs("div",{className:"flex gap-3 p-4 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[r!=null&&r.userImage?e.jsx("img",{src:r.userImage,alt:r.userName,className:"w-8 h-8 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center flex-shrink-0",children:e.jsx(C,{className:"w-4 h-4 text-slate-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white text-sm",children:(r==null?void 0:r.userName)||"Loading..."}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:t(l.createdAt)})]}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 text-sm break-words",children:l.text})]}),e.jsx("button",{onClick:d,className:"p-1.5 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors flex-shrink-0",title:"Delete comment",children:e.jsx(S,{size:14})})]})}function $({forumId:l,comments:s,loading:n,repository:r}){const{user:a}=F(),[t,d]=m.useState(""),[o,u]=m.useState(!1),c=async i=>{if(i.preventDefault(),!(!t.trim()||!a)){u(!0);try{await r.addComment(l,t,a.uid),d("")}catch(b){h.error("Error adding comment:",b)}finally{u(!1)}}};return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("form",{onSubmit:c,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:t,onChange:i=>d(i.target.value),placeholder:"Write a comment...",className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("button",{type:"submit",disabled:o||!t.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[o?e.jsx(N,{className:"w-4 h-4 animate-spin"}):e.jsx(E,{size:16}),e.jsx("span",{children:"Send"})]})]}),n?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(N,{className:"w-6 h-6 animate-spin text-blue-600"})}):s.length===0?e.jsx("p",{className:"text-center text-slate-500 dark:text-slate-400 py-8",children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"space-y-3",children:s.map(i=>e.jsx(O,{comment:i,repository:r,onDelete:()=>r.deleteComment(l,i.id)},i.id))})]})}function W({forum:l,repository:s,isExpanded:n,onToggleExpand:r,onDelete:a}){const[t,d]=m.useState(null),{comments:o,loading:u}=B(s,n?l.id:null);m.useEffect(()=>{s.getUserDetails(l.userId).then(d)},[l.userId,s]);const c=i=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(i);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t!=null&&t.userImage?e.jsx("img",{src:t.userImage,alt:t.userName,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center",children:e.jsx(C,{className:"w-5 h-5 text-slate-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-1",children:l.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:(t==null?void 0:t.userName)||"Loading..."}),e.jsx("span",{children:"•"}),e.jsx("span",{children:c(l.createdAt)}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-xs font-medium",children:l.category})]})]})]}),e.jsx("button",{onClick:()=>a(l.id),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Delete forum post",children:e.jsx(S,{size:18})})]}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:l.description}),e.jsxs("button",{onClick:r,className:"flex items-center gap-2 mt-4 px-4 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-colors text-sm font-medium",children:[e.jsx(I,{size:16}),e.jsxs("span",{children:[o.length," Comments"]}),n?e.jsx(A,{size:16}):e.jsx(L,{size:16})]})]}),n&&e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50",children:e.jsx($,{forumId:l.id,comments:o,loading:u,repository:s})})]})}function X({forums:l,loading:s,repository:n,onDelete:r}){const[a,t]=m.useState(null);return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-blue-600"})}):l.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No forum posts found. Create one to get started!"})}):e.jsx("div",{className:"space-y-4",children:l.map(d=>e.jsx(W,{forum:d,repository:n,isExpanded:a===d.id,onToggleExpand:()=>t(a===d.id?null:d.id),onDelete:r},d.id))})}function G({onSubmit:l,onCancel:s}){const[n,r]=m.useState(""),[a,t]=m.useState(""),[d,o]=m.useState(!1),u=async c=>{if(c.preventDefault(),!(!n.trim()||!a.trim())){o(!0);try{await l(n,a)}finally{o(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Create Forum Post"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(z,{size:24})})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:n,onChange:c=>r(c.target.value),placeholder:"Enter forum post title",maxLength:200,required:!0,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:[n.length,"/200 characters"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Description *"}),e.jsx("textarea",{value:a,onChange:c=>t(c.target.value),placeholder:"Enter forum post description",maxLength:2e3,required:!0,rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:[a.length,"/2000 characters"]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d||!n.trim()||!a.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d?"Creating...":"Create Post"})]})]})]})})}function Q(){const{user:l}=F(),[s,n]=m.useState("parent"),[r,a]=m.useState(!1),t=m.useMemo(()=>new T,[]),{forums:d,loading:o,error:u}=M(t,s),c=async(b,f)=>{if(l)try{await t.createForum(b,f,s,l.uid),a(!1)}catch(D){h.error("Error creating forum:",D)}},i=async b=>{if(confirm("Are you sure you want to delete this forum post and all its comments?"))try{await t.deleteForum(b)}catch(f){h.error("Error deleting forum:",f)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Forum Management"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Manage forum posts and discussions"})]}),e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(R,{size:20}),"New Forum Post"]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>n("parent"),className:`px-4 py-2 font-medium transition-colors border-b-2 ${s==="parent"?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:"Parent Forums"}),e.jsx("button",{onClick:()=>n("children"),className:`px-4 py-2 font-medium transition-colors border-b-2 ${s==="children"?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:"Children Forums"})]}),r&&e.jsx(G,{onSubmit:c,onCancel:()=>a(!1)}),u&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-red-800 dark:text-red-200",children:["Error loading forums: ",u.message]})}),e.jsx(X,{forums:d,loading:o,repository:t,onDelete:i})]})}export{Q as default};
